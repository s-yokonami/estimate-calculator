<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>見積金額・工数計算ツール</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="page-wrapper">
    <header class="header">
      <h1>見積金額・工数計算ツール</h1>
      <p class="header-description">工数単価・時間を入力すると見積金額・利益率を自動計算します</p>
      <button type="button" class="settings-btn" id="settings-btn" title="設定">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/>
        </svg>
        設定
      </button>
    </header>

    <main class="main">
      <!-- 設定なしバナー -->
      <div class="config-banner" id="config-banner" style="display:none;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <span>設定がされていません。担当者から共有された URL を開くか、右上の
          <button type="button" class="banner-link" id="banner-settings-btn">設定ボタン</button>
          から設定コードを入力してください。
        </span>
      </div>

      <div class="card">

        <!-- 入力フォーム -->
        <section class="section">
          <div class="form-row">
            <div class="form-group form-group--full">
              <label for="memo">メモ<span class="unit">案件名・備考</span></label>
              <input type="text" id="memo" placeholder="例: 「○○サイト」リニューアル">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="hourly-rate">工数単価（時給）<span class="unit">円</span></label>
              <input type="number" id="hourly-rate" placeholder="例: 4700" min="0" step="100">
            </div>
            <div class="form-group">
              <label for="estimated-amount">見積金額<span class="unit">円</span></label>
              <input type="number" id="estimated-amount" placeholder="自動計算 or 直接入力" min="0">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="estimated-hours">予定時間<span class="unit">時間</span></label>
              <input type="number" id="estimated-hours" placeholder="例: 40" min="0" step="0.1">
            </div>
            <div class="form-group">
              <label for="estimated-mandays">予定時間<span class="unit">人日（8h換算）</span></label>
              <input type="number" id="estimated-mandays" placeholder="例: 5.00" min="0" step="0.1">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="actual-hours">実績時間<span class="unit">時間</span></label>
              <input type="number" id="actual-hours" placeholder="例: 38" min="0" step="0.1">
            </div>
            <div class="form-group">
              <label for="actual-mandays">実績時間<span class="unit">人日（8h換算）</span></label>
              <input type="number" id="actual-mandays" placeholder="例: 4.75" min="0" step="0.1">
            </div>
          </div>

          <div class="alert alert-warning" id="over-alert" style="display: none;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
            <span id="over-alert-text"></span>
          </div>

        </section>

        <!-- 販売見積・利益試算セクション -->
        <section class="section" id="profit-section">
          <h2 class="section-title">販売見積・利益試算</h2>

          <div class="result-grid" id="profit-grid">
            <div class="result-item result-item--editable">
              <label class="result-label" for="sales-amount">販売見積金額</label>
              <div class="sales-amount-field">
                <input type="number" id="sales-amount" class="sales-amount-input" placeholder="自動計算 or 直接入力" min="0">
                <span class="sales-amount-unit">円</span>
              </div>
            </div>
            <div class="result-item">
              <span class="result-label">制作費（実績時間 × 工数単価 ※未入力時は予定時間）</span>
              <span class="result-value" id="actual-cost">-</span>
            </div>
            <div class="result-item">
              <span class="result-label">見込利益（販売見積金額 − 制作費）</span>
              <span class="result-value highlight" id="profit-amount">-</span>
            </div>
          </div>

          <!-- 利益率ゲージ -->
          <div class="profit-gauge-wrap" id="profit-gauge-wrap" style="display:none;">
            <div class="profit-gauge-header">
              <span>利益率</span>
              <span id="profit-gauge-pct"></span>
            </div>
            <div class="profit-gauge-outer">
              <div class="profit-gauge-track">
                <div class="profit-gauge-fill" id="profit-gauge-fill"></div>
              </div>
              <div class="profit-gauge-marker" id="profit-gauge-marker" title="目標利益率"></div>
            </div>
          </div>

          <div class="alert alert-warning" id="profit-alert" style="display: none;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
            <span id="profit-alert-text"></span>
          </div>
        </section>

        <!-- 等級別工数セクション -->
        <section class="section collapsible-section" id="grade-section">
          <button type="button" class="section-toggle" id="grade-toggle">
            <svg class="toggle-arrow" id="grade-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
            <span>等級別工数分析</span>
          </button>

          <div class="section-body" id="grade-body">
            <div id="grade-grid">
              <div class="result-placeholder">見積金額を入力すると等級別比較が表示されます</div>
            </div>
          </div>
        </section>

        <!-- リセットボタン -->
        <div class="footer-actions">
          <button type="button" class="btn-reset" id="reset-btn">入力をリセット</button>
          <button type="button" class="btn-save-history" id="save-history-btn">履歴に保存</button>
          <button type="button" class="btn-copy-url" id="copy-url-btn">共有URLを生成</button>
          <div class="share-url-row" id="share-url-row" style="display:none;">
            <div class="share-url-controls">
              <input type="text" id="share-url-out" class="share-url-input" readonly>
              <button type="button" class="btn-secondary" id="share-copy-url">URLをコピー</button>
            </div>
            <p class="url-share-warning">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
              設定情報も含まれます。社内のみで共有してください
            </p>
          </div>
        </div>
      </div>

      <!-- 過去案件の履歴 -->
      <div class="history-card" id="history-card" style="display:none;">
        <div class="history-card-header">
          <h2 class="history-card-title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="15" height="15"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            過去の案件
            <span class="history-count" id="history-count"></span>
          </h2>
          <button type="button" class="btn-clear-history" id="clear-history-btn">すべて削除</button>
        </div>
        <div id="history-list"></div>
      </div>
    </main>

    <footer class="footer">
      <p>1人日 ＝ 8時間</p>
    </footer>
  </div>

  <script type="module" src="/script.js"></script>

  <!-- 設定モーダル -->
  <div class="modal-overlay" id="settings-modal">
    <div class="modal">
      <div class="modal-header">
        <h2>設定</h2>
        <button type="button" class="modal-close" id="settings-close">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <p class="modal-desc">各項目を入力して「設定を適用」してください。<br>
          配布用URLを生成して担当者に渡すことで、ユーザーはURLを開くだけで設定が自動完了します。</p>

        <div class="config-form">
          <div class="config-section-title">利益設定</div>

          <div class="config-field">
            <label class="config-label" for="cfg-profit-margin">目標利益率</label>
            <div class="config-input-wrap">
              <input type="number" id="cfg-profit-margin" class="config-number-input" min="0" max="100" step="1" placeholder="50">
              <span class="config-unit">%</span>
            </div>
            <p class="config-hint">見積金額に乗せる利益率（例: 50 → 1.5倍）</p>
          </div>

          <div class="config-field">
            <label class="config-label" for="cfg-default-rate">デフォルト工数単価</label>
            <div class="config-input-wrap">
              <input type="number" id="cfg-default-rate" class="config-number-input" min="0" step="100" placeholder="4000">
              <span class="config-unit">円/時</span>
            </div>
            <p class="config-hint">ページを開いたときに自動入力される時給</p>
          </div>

          <div class="config-section-title" style="margin-top: 18px;">等級別時給</div>

          <div class="config-grade-grid">
            <div class="config-field">
              <label class="config-label" for="cfg-grade-1">等級 1</label>
              <div class="config-input-wrap">
                <input type="number" id="cfg-grade-1" class="config-number-input" min="0" step="100" placeholder="2000">
                <span class="config-unit">円/時</span>
              </div>
            </div>
            <div class="config-field">
              <label class="config-label" for="cfg-grade-2">等級 2</label>
              <div class="config-input-wrap">
                <input type="number" id="cfg-grade-2" class="config-number-input" min="0" step="100" placeholder="3000">
                <span class="config-unit">円/時</span>
              </div>
            </div>
            <div class="config-field">
              <label class="config-label" for="cfg-grade-3">等級 3</label>
              <div class="config-input-wrap">
                <input type="number" id="cfg-grade-3" class="config-number-input" min="0" step="100" placeholder="4000">
                <span class="config-unit">円/時</span>
              </div>
            </div>
            <div class="config-field">
              <label class="config-label" for="cfg-grade-4">等級 4</label>
              <div class="config-input-wrap">
                <input type="number" id="cfg-grade-4" class="config-number-input" min="0" step="100" placeholder="5000">
                <span class="config-unit">円/時</span>
              </div>
            </div>
            <div class="config-field">
              <label class="config-label" for="cfg-grade-5">等級 5</label>
              <div class="config-input-wrap">
                <input type="number" id="cfg-grade-5" class="config-number-input" min="0" step="100" placeholder="6000">
                <span class="config-unit">円/時</span>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-primary" id="config-apply">設定を適用</button>
          <button type="button" class="btn-secondary" id="config-gen-url">配布用URLを生成</button>
        </div>

        <div class="config-url-section" id="config-url-section">
          <label class="modal-label">配布用URL（ユーザーに渡すURL）</label>
          <div class="config-url-row">
            <input type="text" id="config-url-out" class="config-url-input" readonly placeholder="「配布用URLを生成」をクリックすると生成されます">
            <button type="button" class="btn-secondary" id="config-copy-url">URLをコピー</button>
          </div>
          <p class="url-share-warning">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
            利益率・等級単価が含まれます。社外には共有しないでください
          </p>
        </div>
      </div>
    </div>
  </div>

</body>
</html>
